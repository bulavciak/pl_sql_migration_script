EN
PL/SQL Data Migration Script Documentation

This script is used to migrate data from the source_table table to the destination_table table in the database. The script supports batch migration, logging, and retrying the migration in case of failure.

Prerequisites
  -The source_table, destination_table, and migration_log tables exist.

  -The migration_log table should have the following structure:

CREATE TABLE migration_log (
log_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
migration_date TIMESTAMP,
rows_migrated NUMBER,
error_message VARCHAR2(4000)
);

Parameters
  -v_batch_size: Batch size, which determines the number of rows to be migrated in one cycle (default 100).
  -v_max_retries: Maximum number of migration attempts in case of failure (default 3).

Functionality
  -Get table size: The script first gets the number of rows in source_table and checks if there is data to migrate.
  -Batch migration: The script moves data in batches, with each batch being stored in destination_table.
  -Migration logging: After each successful batch, the migration date, the number of rows moved, and no error message (NULL) are written to the migration_log table.
  -Retry migration: In case of failure, the script attempts the migration a maximum of v_max_retries times. After each failure, the number of attempts is increased.
  -Error logging: In case of an error, an error message is written to the log and the number of rows moved is set to 0.
  -Delete migrated data: After a successful migration, the data from source_table is deleted.

Output
  -The script prints reports about the success of the migration and the number of rows moved.
  -In case of an error, an error message and information about the migration attempts are printed.

Usage Example
  -The script runs directly in a PL/SQL environment (e.g. Oracle SQL Developer) and performs data migration according to defined conditions.

Notes
  -Adjust the table names and conditions according to your needs before running the script.
  -It is recommended to test the script in a test environment before deploying it to production.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SK
Dokumentácia k PL/SQL Skriptu na Migráciu Dát

Tento skript slúži na migráciu dát z tabuľky source_table do tabuľky destination_table v databáze. Skript podporuje dávkovú migráciu, logovanie a opakovanie migrácie v prípade zlyhania.

Predpoklady
  -Existencia tabuliek source_table, destination_table a migration_log.

  -Tabuľka migration_log by mala mať nasledujúcu štruktúru:

CREATE TABLE migration_log (
    log_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    migration_date TIMESTAMP,
    rows_migrated NUMBER,
    error_message VARCHAR2(4000)
);

Parametre
  -v_batch_size: Veľkosť dávky, ktorá určuje počet riadkov presúvaných v jednom cykle (predvolene 100).
  -v_max_retries: Maximálny počet pokusov o migráciu v prípade zlyhania (predvolene 3).
  
Funkcionalita
  -Získanie veľkosti tabuľky: Skript najprv získa počet riadkov v source_table a skontroluje, či existujú dáta na migráciu.
  -Dávková migrácia: Skript presúva dáta po dávkach, pričom každá dávka sa ukladá do destination_table.
  -Logovanie migrácie: Po každej úspešnej dávke sa do tabuľky migration_log zapisuje dátum migrácie, počet presunutých riadkov a žiadna chybová správa (NULL).
  -Opakovanie migrácie: V prípade zlyhania sa skript pokúsi o migráciu maximálne v_max_retries krát. Po každom zlyhaní sa zvyšuje počet pokusov.
  -Logovanie chýb: V prípade chyby sa do logu zapisuje chybová správa a počet presunutých riadkov je nastavený na 0.
  -Odstránenie presunutých dát: Po úspešnej migrácii sa dáta zo source_table odstránia.
  
Výstup
  -Skript vypisuje správy o úspešnosti migrácie a počte presunutých riadkov.
  -V prípade chyby sa vypíše chybová správa a informácie o pokusoch o migráciu.
  
Príklad použitia
  -Skript sa spustí priamo v PL/SQL prostredí (napr. Oracle SQL Developer) a vykoná migráciu dát podľa definovaných podmienok.

Poznámky
  -Upravte názvy tabuliek a podmienky podľa svojich potrieb pred spustením skriptu.
  -Odporúča sa testovať skript v testovacom prostredí pred nasadením do produkcie.
